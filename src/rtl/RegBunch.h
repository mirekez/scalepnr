#pragma once

#include "Inst.h"
#include "referable.h"
#include "Clock.h"

namespace rtl
{

struct CombStats
{
    int size = 0;  // number of comb. elements + number of nets in the Bunch
    int weight = 0;  // size of all Bunches using that combs inside
    int max_length = 0;
    double max_delay = 0;
    double max_deficit = -100;
};

struct RegBunch
{
    // must have
    Inst* reg_in;
    Clock* clk_in;
    // optional
    std::vector<rtl::Inst*> members;
    std::vector<Referable<RegBunch>> sub_bunches;

    struct CombStats stats;
};


}

//   │clk
// ┌─▼──┐                ┌──┐  ┌──┐                                   │clk
// │┌──┐│        ────────┤  │  │  │◄───────────────┐         reg_out┌─▼──┐
// ││  ││        ────────┤  │◄─┤  │  ┌──┐          │┌──┐            │┌──┐│
// ││  ││        ────────┤  │  │  │◄┐│  │◄─────────┴┤  │◄──────────┬┤│  ││
// ││  ││        ────────┤  │  └──┘ ├┤  │           └──┘           ││└──┘│
// ││  ││        ────────┤  │◄──────┘│  │◄─────────────────────────┘└────┘
// ││  ││        ────────┤  │        │  │             │clk
// ││  ││        ────────┤  │        │  │    reg_out┌─▼──┐
// │└──┘│               ┌┤  │◄──────┐│  │           │┌──┐│
// └────┘               │└──┘ ┌─────┼┤  │◄──────────┤│  ││
//                 ┌──┐ │┌──┐ │┌──┐ ││  │           │└──┘│
// ┌───┐reg_in     │  │◄┘│  │◄┘│  │◄┘│  │           └────┘   reg_out┌───┐
// │ │ │◄──────────┤  │◄─┤  │◄┬┤  │  │  │◄──────────────────────────┤ ▲ │
// └─▼─┘           │  │  └──┘ ││  │◄┐│  │           ┌────┐          └─┴─┘
//  OBUF           │  │◄──────┤└──┘ ├┤  │◄──────────┤┌──┐│           IBUF
// ┌────┐          │  │◄┐┌──┐ │┌──┐ ││  │◄──────────┤│  ││
// │┌──┐│          └──┘ ││  │◄┘│  │◄┘└──┘           ││  ││
// │└──┘│       ────────┼┤  │◄─┤  │◄────────────────┤│  ││
// └▲───┘               ││  │◄┐│  │◄┐┌──┐           ││  ││
// ┌────┐               │└──┘ │└──┘ ││  │◄──────────┤│  ││
// │┌──┐│       ────────┤     │┌──┐ ├┤  │◄──────────┤│  ││
// │└──┘│       ────────┤     ││  │◄┘│  │◄──────────┤│  ││
// └▲───┘               │     └┤  │  └──┘           ││  ││
// ┌────┐               │      │  │◄────────────────┤└──┘│
// │┌──┐│       ────────┤      └──┘          reg_out└─▲──┘
// │└──┘│       ────────┘                             │clk
// └▲───┘
//  │clk
