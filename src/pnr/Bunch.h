#pragma once

#include "Conn.h"
#include "Inst.h"
#include "referable.h"
#include "Clocks.h"

namespace pnr
{

struct Bunch
{
    // must have
    rtl::Inst* reg_in;
    clk::Clock* clk_in;
    // optional
    std::vector<rtl::Inst*> members;
    std::vector<Bunch> sub_bunches;

    int size = 0;  // number of comb. elements + number of nets in the Bunch
    int weight = 0;  // size of all Bunches using that combs inside
};


}

//   │clk
// ┌─▼──┐reg_in          ┌──┐  ┌──┐                                   │clk
// │┌──┐│◄───────────────┤  │  │  │◄───────────────┐         reg_out┌─▼──┐
// ││  ││◄───────────────┤  │◄─┤  │  ┌──┐          │┌──┐            │┌──┐│
// ││  ││◄───────────────┤  │  │  │◄┐│  │◄─────────┴┤  │◄──────────┬┤│  ││
// ││  ││◄───────────────┤  │  └──┘ ├┤  │           └──┘           ││└──┘│
// ││  ││◄───────────────┤  │◄──────┘│  │◄─────────────────────────┘└────┘
// ││  ││◄───────────────┤  │        │  │             │clk
// ││  ││◄───────────────┤  │        │  │    reg_out┌─▼──┐
// │└──┘│               ┌┤  │◄──────┐│  │           │┌──┐│
// └────┘               │└──┘ ┌─────┼┤  │◄──────────┤│  ││
//                 ┌──┐ │┌──┐ │┌──┐ ││  │           │└──┘│
// ┌───┐ reg_in    │  │◄┘│  │◄┘│  │◄┘│  │           └────┘   reg_out┌───┐
// │ │ │◄──────────┤  │◄─┤  │◄┬┤  │  │  │◄──────────────────────────┤ ▲ │
// └─▼─┘           │  │  └──┘ ││  │◄┐│  │           ┌────┐          └─┴─┘
//  OBUF           │  │◄──────┤└──┘ ├┤  │◄──────────┤┌──┐│           IBUF
// ┌────┐          │  │◄┐┌──┐ │┌──┐ ││  │◄──────────┤│  ││
// │┌──┐│reg_in    └──┘ ││  │◄┘│  │◄┘└──┘           ││  ││
// │└──┘│◄──────────────┼┤  │◄─┤  │◄────────────────┤│  ││
// └▲───┘               ││  │◄┐│  │◄┐┌──┐           ││  ││
// ┌────┐reg_in         │└──┘ │└──┘ ││  │◄──────────┤│  ││
// │┌──┐│◄──────────────┤     │┌──┐ ├┤  │◄──────────┤│  ││
// │└──┘│◄──────────────┤     ││  │◄┘│  │◄──────────┤│  ││
// └▲───┘               │     └┤  │  └──┘           ││  ││
// ┌────┐reg_in         │      │  │◄────────────────┤└──┘│
// │┌──┐│◄──────────────┤      └──┘          reg_out└─▲──┘
// │└──┘│◄──────────────┘                             │clk
// └▲───┘
//  │clk
